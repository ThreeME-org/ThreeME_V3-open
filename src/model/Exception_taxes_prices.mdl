##### Carbon tax


#### Incomes generated by intermediary consumption emissions

##! Carbon tax in value on intermediary consumption emissions depending on $ghg$ emission types, commodity $c$ in sector $s$
T2VAL_CI[ghg,c,s] = R2_CI[ghg,c,s] * EMS_CI[ghg,c,s]  				if EMS_CI[ghg,c,s] <> 0

##! Carbon tax in volume on intermediary consumption emissions depending on $ghg$ emission types, commodity $c$ in sector $s$
T2_CI[ghg,c,s] = @elem(R2_CI[ghg,c,s],%baseyear) * EMS_CI[ghg,c,s] 	if EMS_CI[ghg,c,s] <> 0

##! Carbon tax in value on intermediary consumption emissions depending on $ghg$ emission types and commodity $c$
T2VAL_CI[ghg,c] = sum(T2VAL_CI[ghg,c,s] on s)

##! Carbon tax in value on intermediary consumption emissions depending on $ghg$ emission types and domestic commodity $c$
T2VAL_CID[ghg,c] = sum(T2VAL_CI[ghg,c,s] * CID[c,s] / (CI[c,s] + eps)  on s)

##! Carbon tax in volume on intermediary consumption emissions depending on $ghg$ emission types and domestic commodity $c$
T2_CID[ghg,c] = sum(T2_CI[ghg,c,s] * CID[c,s] / (CI[c,s] + eps)  on s)

##! Carbon tax in value on intermediary consumption emissions depending on $ghg$ emission types and imported commodity $c$
T2VAL_CIM[ghg,c] = sum(T2VAL_CI[ghg,c,s] * CIM[c,s] / (CI[c,s] + eps) on s)

##! Carbon tax in volume on intermediary consumption emissions depending on $ghg$ emission types and imported commodity $c$
T2_CIM[ghg,c] = sum(T2_CI[ghg,c,s] * CIM[c,s] / (CI[c,s] + eps)  on s)

##! Carbon tax in value on intermediary consumption emissions depending on $ghg$ emission types and sector $s$
T2VAL_CI[ghg,s] = sum(T2VAL_CI[ghg,c,s] on c)

##! Carbon tax in value on intermediary consumption emissions depending on commodity $c$ and sector $s$
T2VAL_CI[c,s] = sum(T2VAL_CI[ghg,c,s] on ghg)

##! Carbon tax in value on intermediary consumption emissions depending on $ghg$ emission types
T2VAL_CI[ghg] = sum(T2VAL_CI[ghg,c] on c)

##! Carbon tax in value on intermediary consumption emissions depending on commodity $c$
T2VAL_CI[c] = sum(T2VAL_CI[ghg,c] on ghg)

##! Carbon tax in value on intermediary consumption emissions depending on domestic commodity $c$
T2VAL_CID[c] = sum(T2VAL_CID[ghg,c] on ghg)

##! Carbon tax in volume on intermediary consumption emissions depending on domestic commodity $c$
T2_CID[c] = sum(T2_CID[ghg,c] on ghg)

##! Carbon tax in value on intermediary consumption emissions depending on imported commodity $c$
T2VAL_CIM[c] = sum(T2VAL_CIM[ghg,c] on ghg)

##! Carbon tax in volume on intermediary consumption emissions depending on imported commodity $c$
T2_CIM[c] = sum(T2_CIM[ghg,c] on ghg)

##! Carbon tax in value on intermediary consumption emissions depending on sector $s$
T2VAL_CI[s] = sum(T2VAL_CI[ghg,s] on ghg)

##! Carbon tax in value on intermediary consumption emissions
T2VAL_CI = sum(T2VAL_CI[s] on s)

#### Incomes generated by material emissions

##! Carbon tax in value on material emissions depending on $ghg$ emission types, commodity $c$ in sector $s$
T2VAL_MAT[ghg,s] = R2_MAT[ghg,s] * EMS_MAT[ghg,s] 					if EMS_MAT[ghg,s] <> 0

##! Carbon tax in volume on material emissions depending on $ghg$ emission types, commodity $c$ in sector $s$
T2_MAT[ghg,s] = @elem(R2_MAT[ghg,s], %baseyear) * EMS_MAT[ghg,s] 	if EMS_MAT[ghg,s] <> 0

##! Carbon tax in value on material emissions depending on $ghg$ emission types
T2VAL_MAT[ghg] = sum(T2VAL_MAT[ghg,s] on s)

##! Carbon tax in volume on material emissions depending on $ghg$ emission types
T2_MAT[ghg] = sum(T2_MAT[ghg,s] on s)

##! Carbon tax in value on material emissions depending on commodity $c$
T2VAL_MAT[s] = sum(T2VAL_MAT[ghg,s] on ghg)

##! Carbon tax in volume on material emissions depending on commodity $c$
T2_MAT[s] = sum(T2_MAT[ghg,s] on ghg)

##! Carbon tax in value on material emissions
T2VAL_MAT = sum(T2VAL_MAT[s] on s)

#### Incomes generated by production emissions

##! Carbon tax in value on production emissions depending on $ghg$ emission types, commodity $c$ in sector $s$
T2VAL_Y[ghg,s] = R2_Y[ghg,s] * EMS_Y[ghg,s] 				if EMS_Y[ghg,s]  <> 0

##! Carbon tax in volume on production emissions depending on $ghg$ emission types, commodity $c$ in sector $s$
T2_Y[ghg,s] = @elem(R2_Y[ghg,s], %baseyear) * EMS_Y[ghg,s] 	if EMS_Y[ghg,s] <> 0

##! Carbon tax in value on production emissions depending on $ghg$ emission types
T2VAL_Y[ghg] = sum(T2VAL_Y[ghg,s] on s)

##! Carbon tax in volume on production emissions depending on $ghg$ emission types
T2_Y[ghg] = sum(T2_Y[ghg,s] on s)

##! Carbon tax in value on production emissions depending on sector $s$
T2VAL_Y[s] = sum(T2VAL_Y[ghg,s] on ghg)

##! Carbon tax in volume on production emissions depending on sector $s$
T2_Y[s] = sum(T2_Y[ghg,s] on ghg)

##! Carbon tax in value on production emissions
T2VAL_Y = sum(T2VAL_Y[s] on s)

### Incomes generated by production emissions, intermediary consumption emissions and material emissions

##! Total carbon tax in value collected depending on sector s
T2VAL_SEC[s] = T2VAL_Y[s] + T2VAL_CI[s] + T2VAL_MAT[s]

##! Total carbon tax in value collected over firms
T2VAL_SEC = sum(T2VAL_SEC[s] on s)

### Incomes generated by households' emissions

##! Carbon tax in value on households' consumption depending on $ghg$ emission types and commodity $c$
T2VAL_CH[ghg,c] = R2_CH[ghg,c] * EMS_CH[ghg,c] 					if EMS_CH[ghg,c] <> 0

##! Carbon tax in volume on households' consumption depending on $ghg$ emission types and commodity $c$
T2_CH[ghg,c] = @elem(R2_CH[ghg,c],%baseyear) * EMS_CH[ghg,c] 	if EMS_CH[ghg,c] <> 0

##! Carbon tax in value on households' consumption depending on $ghg$ emission types
T2VAL_CH[ghg] = sum(T2VAL_CH[ghg,c] on c)

##! Carbon tax in value on households' consumption depending on commodity $c$
T2VAL_CH[c] = sum(T2VAL_CH[ghg,c] on ghg)

##! Carbon tax in volume on households' consumption depending on commodity $c$
T2_CH[c] = sum(T2_CH[ghg,c] on ghg)

##! Carbon tax in value on households' consumption depending on $ghg$ emission types and commodity $c$
T2VAL_CH = sum(T2VAL_CH[c] on c)


#####  Taxes on commodities & Prices per uses

## There are two versions regarding the specification of prices and taxes on commodities: (1) the basic version where taxes are not differentiated between uses (e.g. intermediary, final consumption, export, etc.) and type (e.g. VAT, subsidies, etc.); (2) the advanced version where this differentiation is made. \\

## This file provides the equations defining with more detail taxes and prices. In the basic version, taxes on commodities are not differentiated between uses. A constant average tax rate on each commodity is assumed. This has the advantage to require less data for the calibration. But this assumption is often unrealistic since taxes on commodities are generally differentiated per uses. For instance, VAT applies on final consumption but not on intermediary consumption or exports. Subsidies are generally higher for domestic than imported products. When the equations of this section are activated in ThreeME, the heterogeneity regarding the tax rates is taken into account. Additional data are required to disaggregate taxes. The average tax rate is not constant anymore and becomes an endogenous variable that depends on the evolution of structure of taxes and subsidies. To preserve the accountancy consistency of the model, prices have also to be amended compared to the basic version. \\

####  Taxes on commodities

### Average tax rates on commodities

##! Net taxes on domestically produced commodity $c$ expressed in value
@over NTAXCD_VAL[c] = PVATD[c] * VATD[c] + POTHCTD[c] * OTHCTD[c] + PSUBCD[c] * SUBCD[c]  + T2VAL_CH[c] * CHD[c]/(CH[c]+eps) + T2VAL_CID[c]

##! Net taxes on domestically produced commodity $c$
@over NTAXCD[c]     =            VATD[c] +              OTHCTD[c] +             SUBCD[c] +  T2_CH[c] * CHD[c]/(CH[c]+eps)    + T2_CID[c]
## This is not defined anymore by simply assuming a constant rate over the production value: $NTAXCD^{VAL}_{c} = RNTAXCD_{c}*PYQ_{c}*YQ_{c}$. Different taxes are now defined depending on their basis (see below). \\

##! Average tax rate on domestically produced commodity $c$
RNTAXCD[c] = NTAXCD_VAL[c] / (PYQ[c] * YQ[c])     if YQ[c] <> 0

## This rate become now endogenous by inverting the equation of $NTAXCD^{VAL}_{c}$. This specification ensures the accounting equality between the various GDP definition. \\

##! Net taxes on imported commodity $c$ expressed in value
@over NTAXCM_VAL[c] = PVATM[c] * VATM[c] + POTHCTM[c] * OTHCTM[c] + PSUBCM[c] * SUBCM[c] + T2VAL_CH[c] * CHM[c]/(CH[c]+eps) + T2VAL_CIM[c]

##! Net taxes on imported commodity $c$
@over NTAXCM[c]     =            VATM[c] +              OTHCTM[c] +             SUBCM[c] + T2_CH[c]    * CHM[c]/(CH[c]+eps) + T2_CIM[c]

##! Average tax rate on imported commodity $c$
RNTAXCM[c] = NTAXCM_VAL[c] / (PM[c]  * M[c] )   if M[c] <> 0

### Value-added tax (value & volume)

##! Price of value-added tax on domestically produced commodity $c$
#PVATD[c]   * VATD[c]   =       RVATD[c] * (PCHD[c]     * CHD[c]) / (1 + RVATD[c])                    if VATD[c]       <> 0
PVATD[c]    * VATD[c]   =       RVATD[c] * PYQSBVAT[c]  * CHD[c]  / (1 + @elem(RVATD[c], %baseyear))  if VATD[c]       <> 0

##! Value-added tax on domestically produced commodity $c$
VATD[c]                 = @elem(RVATD[c],%baseyear)     * CHD[c]  / (1 + @elem(RVATD[c], %baseyear))  if VATD[c]       <> 0

##! Price of value-added tax on imported commodity $c$
# PVATM[c]  * VATM[c]   =       RVATM[c]  * (PCHM[c]    * CHM[c]) / (1 + RVATM[c])                    if VATM[c]       <> 0
PVATM[c]    * VATM[c]   =       RVATM[c]  * PMSBVAT[c]  * CHM[c]  / (1 + @elem(RVATM[c], %baseyear))  if VATM[c]       <> 0

##! Value-added tax on imported commodity $c$
              VATM[c]   = @elem(RVATM[c],%baseyear)     * CHM[c]  / (1 + @elem(RVATM[c], %baseyear))  if VATM[c]       <> 0

### Other taxes on commodities (value & volume)

##! Price of other taxes on domestically produced commodity $c$
POTHCTD[c] * OTHCTD[c] =       ROTHCTD[c]   * PYQ[c]  * YQ[c]                                   if OTHCTD[c]     <> 0

##! Other taxes on domestically produced commodity $c$
             OTHCTD[c] = @elem(ROTHCTD[c], %baseyear) * YQ[c]                                   if OTHCTD[c]     <> 0

##! Price other taxes on imported commodity $c$
POTHCTM[c] * OTHCTM[c] =       ROTHCTM[c] * PM[c]     * M[c]                                    if OTHCTM[c]     <> 0

##! Other taxes on imported commodity $c$
             OTHCTM[c] = @elem(ROTHCTM[c], %baseyear) * M[c]                                    if OTHCTM[c]     <> 0

### Subsidies on commodities (value & volume)

##!Price of subsidies on domestically produced commodity $c$
PSUBCD[c]  * SUBCD[c]  =       RSUBCD[c]              * YQ[c]                                   if SUBCD[c]      <> 0

##! Subsidies on domestically produced commodity $c$
             SUBCD[c]  = @elem(RSUBCD[c], %baseyear)  * YQ[c]                                   if SUBCD[c]      <> 0

## We assume that subsidies are proportional to on the volume of production which is often the cases (in particular for agriculture). Consequently the price of the subvention grows like the subvention rate. For simplicity, we assume that at the steady state, the subvention rate grows at the rate of inflation. \\

##! Price of subsidies on imported commodity $c$
PSUBCM[c]  *  SUBCM[c] =       RSUBCM[c]              * M[c]                                    if SUBCM[c]      <> 0

##! Subsidies on imported commodity $c$
              SUBCM[c] = @elem(RSUBCM[c], %baseyear)  * M[c]                                    if SUBCM[c]      <> 0

#######################################

#### Prices of commodities
##  Prices are amended to be consistent with the above specification of taxes. \\

##! Selling price before VAT for domestically produced commodity $c$
PYQSBVAT[c] * YQSBVAT[c] = PYQ[c] * YQ[c] + POTHCTD[c] * OTHCTD[c] + PSUBCD[c] * SUBCD[c] + PMGPD[c] * MGPD[c] if YQSBVAT[c] <> 0

##! Production of commodity $c$ expressed at market price before VAT
YQSBVAT[c] = YQ[c] + OTHCTD[c] + SUBCD[c] + MGPD[c] 														   if YQSBVAT[c] <> 0

## $YQSBVAT_{c}$ is the volume of the production expressed at market price before VAT. It should \textbf{\underline{not}} be seen as a composite of several ''goods'': production at basic price, margins and taxes. Indeed, it does not increase when the volume of the commercial and transport margins increase. The price does instead. Consequently, $YQSBVAT_{c}$ is always proportional to $YQ_{c}$. Notice the consistency with the specification of the volume of a tax or a subvention: the tax rate does not increase the volume of the tax but increases its price. The volume of the tax increases only when the volume of the tax base (e.g. consumption, production) increases. \\

##! Selling price before VAT for imported commodity $c$
PMSBVAT[c]  * MSBVAT[c]  = PM[c]  * M[c]  + POTHCTM[c] * OTHCTM[c] + PSUBCM[c] * SUBCM[c] + PMGPM[c] * MGPM[c] if MSBVAT[c]  <> 0

##! Imports of commodity $c$ expressed at market price before VAT
MSBVAT[c]  = M[c]  + OTHCTM[c] + SUBCM[c] + MGPM[c] 														   if MSBVAT[c]  <> 0

##! Market price of margins supplied by domestically produced commodity $c$
@over PMGSD[c]   = PYQSBVAT[c]                                                     if MGSD[c]   <> 0

##! Market price of margins supplied by imported commodity $c$
@over PMGSM[c]   = PMSBVAT[c]                                                      if MGSM[c]   <> 0

##! Market price of domestically produced intermediate consumption $c$ purchased by sector $s$
@over PCID[c, s] = PYQSBVAT[c] + T2VAL_CI[c,s] / CI[c,s]                    if CID[c, s] <> 0

##! Market price of imported intermediate consumption $c$ purchased by sector $s$
@over PCIM[c, s] = PMSBVAT[c]  + T2VAL_CI[c,s] / CI[c,s]                    if CIM[c, s] <> 0

##! Market price of domestically produced households final consumption $c$
@over PCHD[c]    = PYQSBVAT[c] * (1 + RVATD[c]) / (1 + @elem(RVATD[c], %baseyear)) + T2VAL_CH[c] / CH[c] if CHD[c]    <> 0

##! Market price of imported households final consumption $c$
@over PCHM[c]    = PMSBVAT[c]  * (1 + RVATM[c]) / (1 + @elem(RVATM[c], %baseyear)) + T2VAL_CH[c] / CH[c] if CHM[c]    <> 0

##! Market price of domestically produced Government final consumption $c$
@over PGD[c]     = PYQSBVAT[c]                                                     if GD[c]     <> 0

##! Market price of imported Government final consumption $c$
@over PGM[c]     = PMSBVAT[c]                                                      if GM[c]     <> 0

##! Market price of domestically produced investment $c$ purchased by sector $s$
@over PID[c, s]  = PYQSBVAT[c]                                                     if ID[c, s]  <> 0

##! Market price of imported investment $c$ purchased by sector $s$
@over PIM[c, s]  = PMSBVAT[c]                                                      if IM[c, s]  <> 0

##! Market price of domestically produced exports $c$
@over PXD[c]     = PYQSBVAT[c]                                                     if XD[c]     <> 0

##! Market price of imported exports (re-exports) $c$
@over PXM[c]     = PMSBVAT[c]                                                      if XM[c]     <> 0

##! Market price of domestically produced change in inventories $c$
@over PDSD[c]    = PYQSBVAT[c]                                                     if DSD[c]    <> 0

##! Market price of imported change in inventories $c$
@over PDSM[c]    = PMSBVAT[c]                                                      if DSM[c]    <> 0

##################################
### Aggregation of taxes

##! Aggregate market price for value-added tax paid on domestically produced comodities
PVATD   * VATD = sum(PVATD[c] *     VATD[c]   if VATD[c]   <> 0 on c)  if VATD   <> 0
##! Aggregate value-added tax paid on domestically produced comodities
          VATD = sum(               VATD[c]   if VATD[c]   <> 0 on c)  if VATD   <> 0

##! Aggregate market price for other product tax paid on domestically produced comodities
POTHCTD * OTHCTD = sum(POTHCTD[c] * OTHCTD[c] if OTHCTD[c] <> 0 on c)  if OTHCTD <> 0

##! Aggregate other product tax paid on domestically produced comodities
          OTHCTD = sum(             OTHCTD[c] if OTHCTD[c] <> 0 on c)  if OTHCTD <> 0

##! Aggregate market price for subsidies on domestically produced commodities
PSUBCD  * SUBCD  = sum(PSUBCD[c]  * SUBCD[c]  if SUBCD[c]  <> 0 on c)  if SUBCD  <> 0

##! Aggregate subsidies on domestically produced commodities
          SUBCD  = sum(             SUBCD[c]  if SUBCD[c]  <> 0 on c)  if SUBCD  <> 0

##! Aggregate market price for value-added tax paid on imported comodities
PVATM   * VATM   = sum(PVATM[c]   * VATM[c]   if VATM[c]   <> 0 on c)  if VATM   <> 0

##! Aggregate value-added tax paid on imported comodities
          VATM   = sum(             VATM[c]   if VATM[c]   <> 0 on c)  if VATM   <> 0

##! Aggregate market price for Other product Tax on imported commododities
POTHCTM * OTHCTM = sum(POTHCTM[c] * OTHCTM[c] if OTHCTM[c] <> 0 on c)  if OTHCTM <> 0

##! Aggregate Other product Tax on imported commododities
          OTHCTM = sum(             OTHCTM[c] if OTHCTM[c] <> 0 on c)  if OTHCTM <> 0

##! Aggregate market price for subsidies on imported commododities
PSUBCM  * SUBCM  = sum(PSUBCM[c]  * SUBCM[c]  if SUBCM[c]  <> 0 on c)  if SUBCM  <> 0

##! Aggregate subsidies on imported commodities
          SUBCM  = sum(             SUBCM[c]  if SUBCM[c]  <> 0 on c)  if SUBCM  <> 0

##! Aggregate market price for Value-added Tax on total households final consumption
PVAT    * VAT    = PVATD   * VATD   + PVATM  * VATM                    if VAT    <> 0

##! Aggregate Value-added Tax on total households final consumption
          VAT    =           VATD   +          VATM                    if VAT    <> 0

##! Aggregate market price for other product Tax
POTHCT  * OTHCT  = POTHCTD * OTHCTD + POTHCTM * OTHCTM                 if OTHCT  <> 0

##! Aggregate Other product Tax
      	  OTHCT  =           OTHCTD +           OTHCTM                 if OTHCT  <> 0

##! Aggregate market price for subsidies on commodities
PSUBC   * SUBC   = PSUBCD  * SUBCD  + PSUBCM  * SUBCM                  if SUBC   <> 0

##! Aggregate subsidies on commodities
          SUBC   =           SUBCD  +           SUBCM                  if SUBC   <> 0

### Average tax rates

##! Average VAT rate on domestically produced commodity
RVATD = (PVATD * VATD) / (PCHD * CHD - PVATD   * VATD)

##! Average rate of other taxes on domestically produced commodity
ROTHCTD = (POTHCTD * OTHCTD) / (PYQ * YQ)

##! Average rate of subsidies on domestically produced commodity
RSUBCD = (PSUBCD  * SUBCD) / YQ

##! Average VAT rate on imported commodity
RVATM = (PVATM * VATM) / (PCHM * CHM - PVATM * VATM)

##! Average rate of other taxes on imported commodity
ROTHCTM = (POTHCTM * OTHCTM) / (PM * M)

##! Average rate of subsidies on imported commodity
RSUBCM = (PSUBCM  * SUBCM) / M

##! Average VAT rate
RVAT = (PVAT * VAT) / (PCH * CH - PVAT   * VAT)

##! Average rate of other taxes on commodity
ROTHCT = (POTHCT * OTHCT) / (PYQ * YQ + PM * M)

##! Average rate of subsidies on commodity
RSUBC = (PSUBC  * SUBC) / (YQ  + M)
