########################################################
######### SUPPLY - USE EQUILIBRIUM #####################
########################################################
### This file provides the equations defining the supply use - equilibrium for the domestic and imported products and at the agregate level.
### It also derives the GDP according to various definitions. 
### Since each relation is written in value and in volume, the value equation defines the price.

#####################
###### USE SIDE #####
#####################

### Domestic and foreign equilibrium for commodities c (value & volume):

@pv Q|O|[c] = MGR|O|[c] + CI|O|[c] + CH|O|[c] + G|O|[c] + I|O|[c] + X|O|[c] + DS|O|[c] if Q|O|[c] <> 0

### Domestic and imported intermediary raw material consumption c (value & volume):

@pv CI|O|[c] = sum(CI|O|[c, s] if CI|O|[c, s] <> 0 on s) if CI|O|[c] <> 0

### Domestic and imported investment in commodity c (value & volume):

PI|O|[c] * I|O|[c] = sum(PIA|O|[c] * IA|O|[c, s] if IA|O|[c, s] <> 0 on s) if I|O|[c] <> 0

I|O|[c] = sum(IA|O|[c, s] if IA|O|[c, s] <> 0 on s) if I|O|[c] <> 0

### Aggregation of imports and domestic production for commodity c per use
### For Q (production of commodities at market price); CH (households'consumption); G (public spendings); I (private investiment); DS (change in inventories)

@pv |V|[c] = |V|D[c] + |V|M[c] if |V|[c] <> 0 where V in Q CH G I DS X


### Aggregation of imports and domestic production per use
@pv |V||O| = sum(|V||O|[c] if |V||O|[c] <> 0 on c) if |V||O| <> 0 where V in Q CH G I X DS CI MGR

### Aggregation per use
@pv |V| = |V|D + |V|M if |V| <> 0 where V in Q CH G I X DS CI MGR




#####################
###### SUPPY SIDE ###
#####################

### Margins paid to on domestic and imported commodity c 
@pv MGP|O|[c] = sum(MGP|O|[cc, c] if MGP|O|[cc, c] <> 0 on cc) if MGP|O|[c] <> 0

###  Domestic production of commodity c at basic price:
###  The price can not be defined as an index because it is already defined as a function of the production price in the price block.

YQ[c]*PYQ[c] + PTAXCD[c]*TAXCD[c] + PMGPD[c]*MGPD[c] = PQD[c]*QD[c] if YQ[c] <> 0

### Same variable calculated from volumes. For verification.
YQbis[c] + TAXCD[c] + MGPD[c] = QD[c] if YQbis[c] <> 0

###  Imported production of commodity c at basic price:
###  The price can not be defined as an index because it is already defined as a function of the production price in the price block.

M[c]*PM[c] + PTAXCM[c]*TAXCM[c] + PMGPM[c]*MGPM[c] = PQM[c]*QM[c] if M[c] <> 0

### Same variable calculated from volumes. For verification.
Mbis[c] + TAXCM[c] + MGPM[c] = QM[c] if Mbis[c] <> 0


#3# Aggregate margins paid on the domesticaly produced commodity c (value & volume):
## juste des agregation
PMGPD * MGPD = sum(PMGPD[c] * MGPD[c] if MGPD[c] <> 0 on c) if MGPD <> 0

        MGPD = sum(           MGPD[c] if MGPD[c] <> 0 on c) if MGPD <> 0

#4## Aggregate margins paid on the imported commodity c (value & volume):

PMGPM * MGPM = sum(PMGPM[c] * MGPM[c] if MGPM[c] <> 0 on c) if MGPM <> 0

        MGPM = sum(           MGPM[c] if MGPM[c] <> 0 on c) if MGPM <> 0


#2## Margins recieved by commodity cc (value & volume):

PMGR[cc] * MGR[cc] = sum(PMGP[cc, c] * MGP[cc, c] if MGP[cc, c] <> 0 on c) if MGR[cc] <> 0

           MGR[cc] = sum(    	 	   MGP[cc, c] if MGP[cc, c] <> 0 on c) if MGR[cc] <> 0

#1## Margins paid to commodity cc on commodity c (value & volume):
#### ICICI Sans doute inutile car déjà eq dans producteur 
PMGP[cc, c] * MGP[cc, c] = PMGPD[cc, c] * MGPD[cc, c] + PMGPM[cc, c] * MGPM[cc, c] if MGP[cc, c] <> 0

			  MGP[cc, c] = 				  MGPD[cc, c] + 			   MGPM[cc, c] if MGP[cc, c] <> 0




### Aggregation of imports 
@pv M = sum(M[c] if M[c] <> 0 on c)




# equations 1.46 & 1.47
#@pv VA[s] = Y[s] - MAT[s] - E[s]

# equations 1.48 & 1.49
#@pv VA = sum(VA[s] on s)



# GDP: VALUE ADDED DEFINITION
# equation 1.30
# To do.
#PGDPter * GDPter = PVA * VA + PTAX * TAX 		if GDPter <> 0


##GDPter = VA + TAXC 	if GDPter <> 0




# equations 1.50 & 1.51
# PEBE[s]*EBE[s] = PVA[s]*VA[s] - CL[s] * L[s] * PROG_L[s] - PIY[s]*IY[s] - PSY[s]*SY[s] where s in %list_sec
# EBE[s] = VA[s] - (CL[s] / PEBE[s]) * L[s] * PROG_L[s] - IY[s] - SY[s]

# equations 1.52 & 1.53
# @pv EBE = sum(EBE[s] on s)

# equations 1.54 & 1.55
# PRF[s]*RF[s] = PEBE[s]*EBE[s] - PK[s]{-1} * Tdec[s] * K[s]{-1} where s in %list_sec
# RF[s] = EBE[s] - @elem(PK[s]{-1}, %baseyear) * Tdec[s] * K[s]{-1}

# equations 1.56 & 1.57
# @pv RF = sum(RF[s] on s)

#RF_NET[sm] = @elem(PRF[sm]{-1}, %baseyear) * RF[sm]{-1} - IS[sm]
# PRF_NET[sm]*RF_NET[sm] = PRF[sm]{-1}*RF[sm]{-1} - PIS[sm] * IS[sm]

# @pv RF_NET = sum(RF_NET[sm] on sm)

#@pv |V| = sum(|V|[s] if |V|[s] <> 0 on s) where V in Y IA
#@pv YQ = sum(YQ[c] if YQ[c] <> 0 on c)



################################
# GDP: USE DEFINITON

## Agregated GDP (value & volume) calculated by using agregates
PGDP*GDP = PCH*CH + PG*G + PI*I + PX*X + PDS*DS - PM*M  		if GDP <> 0

GDP = CH + G + I + X + DS - M 		if GDP <> 0

# GDP for commodity c (value & volume)
@pv GDP[c] = CH[c] + G[c] + I[c] + X[c] + DS[c] - M[c] if GDP[c] <> 0

## Agregated GDP (value & volume) calculated from the GDP per using commodity
@pv GDPbis = sum(GDP[c] if GDP[c] <> 0 on c) 		if GDPbis <> 0














# Verif Compta nat.

#VERIF_PY_PYQ  = PY/PYQ-1
#VERIF_Y_YQ  = PY/PYQ-1

#VERIF_PIAxIA_PIxI = PIA * IA / (PI * I) - 1
#VERIF_PIA_PI = PIA / PI - 1
#VERIF_IA_I = IA / I - 1

#VERIF_GDP_GDPBIS    =  GDP / GDPBIS - 1
#VERIF_GDP_GDPTER    =  GDP / GDPTER - 1
#VERIF_PGDP_PGDPBIS  = PGDP / PGDPBIS - 1
#VERIF_PGDP_PGDPTER  = PGDP / PGDPTER - 1

#VERIF_ValGDP_ValGDPTER = PGDP * GDP / (PGDPTER * GDPTER) - 1

# verifYQbis, margins.  



### To do. Voir si cela ne peut pas être simplifié. Eviter que TCO_val apparaisse ici 

# equations 1.18, 1.19, 1.20 & 1.21
#PCI|O|[cm, s] = PMAT|O|[cm] if CI|O|[cm, s] <> 0
#CI|O|[cm, s] = MAT|O|[cm, s] if CI|O|[cm, s] <> 0

#PCI|O|[ce, s] = PE|O|[ce] + TCO_VAL|O|[ce, s] / E|O|[ce, s] if CI|O|[ce, s] > 0
#CI|O|[ce, s] = E|O|[ce, s] if CI|O|[ce, s] > 0


