##### Energy balance

## This file provides the equations defining the energy balance in physical units. The unit used is the tonne of oil equivalent (toe). The International Energy Agency (IEA) defines the following correspondence: 1 toe = 11.63 megawatt-hours (MWh) = 41.868 gigajoules (GJ). Chapter 1 of the documention discusses in detail the correspondance and differences between the energy balance and the national account definitions and equilibrium. It also provides the hypotheses used to derived the simplified energy balance presented bellow. \\

#### End uses
##! End use for energy $ce$ of sectors, expressed in toe 
CI_toe[ce] = sum(CI_toe[ce, s] if CI_toe[ce, s] <> 0 on s)

##! End use for energy $ce$ of sector $s$, expressed in toe 
d(log(CI_toe[ce, s])) = d(log(CI[ce, s])) if CI_toe[ce, s] <> 0
## This varable regroups the following energy balance variables: energy transformation input, energy sector own use excluding the auto-consumption and “Final consumption” of non-energy sectors. \\

##! End use for energy $ce$ of households, expressed in toe 
d(log(CH_toe[ce])) = d(log(CH[ce])) if CH_toe[ce] <> 0

##! External end use for energy $ce$, expressed in toe 
d(log(X_toe[ce])) = d(log(X[ce])) if X_toe[ce] <> 0

#### Net supply (domestic and imported)
## The total net supply is equal to the total end use. Net supply is the supply consistent with the national account concept of production, that is the physical quantity actually bought by the end user. Compared to the gross supply, it has been corrected from the distribution losses and the auto-consumption of energy producers that do not have any corresponding financial transaction. \\

##! Net production of energy $ce$ by sector $s$, expressed in toe 
Y_toe[ce, s] = PhiY_toe[ce, s] * Y_toe[ce]  if Y_toe[ce, s] <> 0

##! Share of energy $ce$ produced by sector $s$ (national account definition) 
PhiY[ce, s] = (@elem(PY_toe[ce, s], %baseyear) * PhiY_toe[ce, s]) / (sum((@elem(PY_toe[ce, s], %baseyear) * PhiY_toe[ce, s]) if PhiY_toe[ce, s] <> 0 on s)
	)  if PhiY[ce, s] <> 0
## If the (net) production price of energy $ce$ is common amongst producers, the national account definition share is equal to the energy balance definition share. \\

##! Net production of energy $ce$, expressed in toe 
Y_toe[ce] + M_toe[ce] = CI_toe[ce] + CH_toe[ce] + X_toe[ce]
## Net production regroups the primary (indigenous) production (including Recovered & recycled products) and the secondary production (energy transformation output) of the energy balance. Depending on the energy source, this variable is (mainly) a primary or a secondary production: e.g., primary for crude oil and natural gaz; secondary, for electricity. \\

##! Imported net production of energy $ce$, expressed in toe 
d(log(M_toe[ce])) = d(log(M[ce])) if M[ce] <> 0

#### Gross supply (domestic and imported)
## In the energy balance, supply corresponds to a gross production since it includes physical quantities that are not bought by the end user (distribution losses and the auto-consumption of energy producers). They are included here in order to derive the same level of supply as published in the energy balance. \\ 

##! Gross production of energy $ce$ by sector $s$, expressed in toe 
YG_toe[ce, s] = Y_toe[ce, s] + DLY[ce, s] + AC[ce, s] if YG_toe[ce, s] <> 0
## Like for the net production, the gross production regroups the primary (indigenous) production (including Recovered & recycled products) and the secondary production (energy transformation output) of the energy balance. \\

##! Gross production of energy $ce$ by sector $s$, expressed in toe (for verification)
YG_toebis[ce] = Y_toe[ce] + DLY[ce] + AC[ce] if YG_toe[ce] <> 0

verif_YG_toe[ce] = (YG_toebis[ce]/YG_toe[ce] - 1)*100 if YG_toe[ce] <> 0

##! Gross imported energy $ce$, expressed in toe 
MG_toe[ce] = M_toe[ce] + DLM[ce] if MG_toe[ce] <> 0

##! Distribution losses of energy $ce$, expressed in toe 
d(log(DL[ce])) = d(log(CI_toe[ce] + CH_toe[ce] + X_toe[ce])) if DL[ce] <> 0
## For simplicity, we assume that the distribution losses related of energy $ce$ are proportional to the end use of this commodity. \\

##! Distribution losses of energy $ce$ produced by sector $s$, expressed in toe 
DLY[ce, s] = DL[ce] * Y_toe[ce, s] / (Y_toe[ce] + M_toe[ce]) if DL[ce, s] <> 0
## Distribution losses are disaggregated between producers of energy $ce$ proportionally to their share into the total domestic and foreign net production. \\

##! Distribution losses of imported energy $ce$, expressed in toe 
DLM[ce] = DL[ce] * M_toe[ce] / (Y_toe[ce] + M_toe[ce]) if DLM[ce] <> 0

##! Auto-consumption losses of energy $ce$ by producer $s$, expressed in toe 
d(log(AC[ce, s])) = d(log(Y[ce, s])) if AC[ce, s] <> 0
## These are mainly the losses related to the auto-consumption of electricity by electricity producers. This equation allows for taking into account the fact that the loss rate differs per technology. \\ 

##! Gross production of energy $ce$, expressed in toe 
YG_toe[ce] = sum(YG_toe[ce, s] if YG_toe[ce, s] <> 0 on s) if YG_toe[ce] <> 0

#! Distribution losses of energy $ce$ of domestic producers, expressed in toe 
DLY[ce] = sum(DLY[ce, s] if DLY[ce, s] <> 0 on s) if DLY[ce] <> 0

##! Auto-consumption losses of energy $ce$, expressed in toe 
AC[ce] = sum(AC[ce, s] if AC[ce, s] <> 0 on s) if AC[ce] <> 0

#### Indicators

##! Net production rate for energy $ce$
RY_toe[ce] = Y_toe[ce] / YG_toe[ce]

##! Auto-consumption rate of energy $ce$
RDLY[ce] = DLY[ce] / YG_toe[ce] if Y_toe[ce] <> 0

##! Auto-consumption rate of energy $ce$
RAC[ce] = AC[ce] / YG_toe[ce] if AC[ce] <> 0
