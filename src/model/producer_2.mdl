#### Producer

## This file provides the equations defining the producer behaviour.
## Equation are behavioral. They are not used to calibrate the initial value of variables. They may be inverted to calibrate a parameter.
### Margins
## Margins paid to commodity $cc$ on the domestic commodity $c$
## The growth in demand for margins follows the growth of aggregate demand for the commodity $c$ and a substitution term
d(log(MGPD[cc, c])) = d(log(YQ[c])) + d(SUBST_MGPD[cc, c])                                                                                      if MGPD[cc, c] <> 0

# Notional substitution on margins paid
SUBST_n_MGPD[m, c] = sum(- ES_MGPD[m, mm, c] * phi_MGPD[mm, c]{-1} * d(log(PMGPD[m, c]) - log(PMGPD[mm, c])) if MGPD[mm, c] <> 0 on mm) if MGPD[m, c] <> 0

phi_MGPD[m, c]     = PMGPD[m, c] * MGPD[m, c] / (sum(PMGPD[mm, c] * MGPD[mm, c] on mm))                                                   if MGPD[m, c] <> 0

## Margins paid to commodity $m$ on the imported commodity $c$
d(log(MGPM[m, c])) = d(log( M[c])) + d(SUBST_MGPM[m, c])                                                                                      if MGPM[m, c] <> 0

SUBST_n_MGPM[m, c] = sum(- ES_MGPM[m, mm, c] * phi_MGPM[mm, c]{-1} * d(log(PMGPM[m, c]) - log(PMGPM[mm, c])) if MGPM[mm, c] <> 0 on mm) if MGPM[m, c] <> 0

##  share of the margin type $m$ on total margins paid on the domestic commodity $c$
phi_MGPM[m, c]     = PMGPM[m, c] * MGPM[m, c] / (sum(PMGPM[mm, c] * MGPM[mm, c] on mm))                                                   if MGPM[m, c] <> 0

### Production factors
## Production of commodity $c$ by sector $s$
## We assume that each activity $s$ may produce more than one commodity $c$. Therefore the production $Y$ of commodity $c$ by the activity $s$ depends on the parameter $\varphi^{Y}_{c, s}$ which represents the share of sector $s$ in the total production of commodity $c$.
Y[c, s] = PhiY[c, s] * YQ[c] if Y[c, s] <> 0


## Demand for production factor $f$ of sector $s$
d(log(F_n[f, s]))  = d(log(Y[s])) - d(log(PROG[f, s])) + d(SUBST_F[f, s])                                                 if F_n[f, s] <> 0

d(SUBST_n_F[f, s]) = sum(- ES[f, ff, s] * phi[ff, s]{-1} * d(log(C[f, s]/PROG[f, s]) - log(C[ff, s]/PROG[ff, s])) on ff)  if F_n[f, s] <> 0

## Share of production factor $f$ of sector $s$
phi[f, s]          = (C[f, s] * F_n[f, s]) / (sum(C[ff, s] * F_n[ff, s] on ff))

# Aggregate production factors for capital, labor, energy and material
# use list f !!!!!!@@@!!!
# F[f] = sum(F[f, s] on s)

## Aggregate capital input
F[K]   = sum(F[K, s]   on s)

## Aggregate labor input
F[L]   = sum(F[L, s]   on s)

## Aggregate energy input
F[E]   = sum(F[E, s]   on s)

## Aggregate materials input
F[MAT] = sum(F[MAT, s] on s)

## Investment use of commodity $c$ by sector $s$
## For a given sector, we assume that the investment structure is fixed over time. In other words, the investment good is a composite of several commodities in fixed proportion.
d(log(I[c, s])) = d(log(IA[s]))                                                                                           if I[c, s]    <> 0

## Energy input demand by type of energy $ce$ by sector $s$
d(log(CI[ce, s]))    = d(log(F[E, s])) + d(SUBST_CI[ce,s])                                                                if CI[ce, s]  <> 0

d(SUBST_n_CI[ce, s]) = sum(- ES_NRJ[ce, cee, s] * phi[E, cee, s]{-1} * d(log(PCI[ce, s]) - log(PCI[cee, s])) on cee)      if CI[ce, s]  <> 0

## Share of energy input $ce$  on total energy use by sector $s$
phi[E, ce, s] = (PCI[ce, s]*CI[ce, s]) / (sum(PCI[cee, s]*CI[cee, s] on cee))

## Demand for material commodity $cmo$ by sector $s$
## Intermediary consumption that are not transport or energy commodities are not substitutables (Leontief technology)
d(log(CI[cmo, s])) = d(log(F[MAT, s]))                                                                                    if CI[cmo, s] <> 0

## Demand for transport commodities by sector $s$
#  We assume no substitution for Transport with the other inputs
d(log(TRSP[s])) = d(log(F[MAT, s]))                                                                                       if TRSP[s]    <> 0

## Demand for transport commodity $ct$ by sector $s$
d(log(CI[ct, s])) = d(log(TRSP[s])) + d(SUBST_CI[ct,s])                                                                   if CI[ct, s]  <> 0

d(SUBST_n_CI[ct, s]) = sum(- ES_TRSP[ct, ctt, s] * phi_TRSP[ctt, s]{-1} * d(log(PCI[ct, s]) - log(PCI[ctt, s])) on ctt)   if CI[ct, s]  <> 0

## Share for transport $ct$ use in total transport by sector $s$
phi_TRSP[ct, s] = (PCI[ct, s]*CI[ct, s]) / (sum(PCI[ctt, s]*CI[ctt, s] on ctt))

## Technical progress of the production factor $f$ in the sector $s$
PROG[f, s] = PROG[f, s]{-1} * (1 + GR_PROG[f, s])

## Endogenous energy efficiency
## This specification states that the productivity gain of energy input in the sector $s$ for the energy type $ce$ depends on a steady-state trend (exogenous) and a price-induced component. This component is equal to a A $RHO$PROG_E_PE$ share of the log-difference between the level of the general energy price index for the sector $s$ to the general level of prices
GR_PROG[E, s] = @elem(GR_PROG[E, s], %baseyear) + RHO_PROG_E_PE * (log(PE[s]) - log(P) > 0) * d(log(PE[s])-log(P))

# Doute sur le specification ci-dessus qui reprend celle existante:
# GR_PROG_E[s] =  alpha_PROG_E[s] + alpha_PROG_E_PE*((log(PE[s])- log(PCH)>0)*d(log(PE[s])-log(PCH)))
# On a une variation qui affecte un niveau. L'effet doit être faible.
# Je serais tenter de mettre plutot (à discuter!!!):
# GR_PROG[E, s] = @elem(GR_PROG[E, s], %baseyear) + RHO_PROG_E_PE * (log(PE[s]) - log(P) > 0) * (log(PE[s])-log(P))
