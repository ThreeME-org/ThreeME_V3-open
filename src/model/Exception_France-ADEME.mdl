##### Exception equations for ThreeME - France - ADEME



#### Additional equations to fit scenarii 

##! Share of electicity produced by wind sector (national account definition)
PhiY_toe[cele, sewi] = 1 - PhiY_toe[cele, SECH] - PhiY_toe[cele, SECO]- PhiY_toe[cele, SEGA]- PhiY_toe[cele, SEHY]- PhiY_toe[cele, SENU]- PhiY_toe[cele, SEOI]- PhiY_toe[cele, SEOT]- PhiY_toe[cele, SESO]
# The following does not work: Find correct syntax
# PhiY_toe[cele, sewi] = 1 - (sum(PhiY_toe[cele, s] on s, where s in %list_sec \ sewi))


### Fitting baseline GDP

##! Labor technical progress gain
log(1 + GR_PROG[L, s]) = d(log(GDP_trend)) - d(log(POP))

##! Government expenditures
d(log(EXPG)) = d(log(GDP_trend)) + 0.5 * GDP_cont

##! World demand 
d(log(WD[c])) = d(log(GDP_trend)) + 0.5 * GDP_cont

### Fitting energy consumption for non energy sectors

##! Energy efficiency gains in sector $s$
@over d(log(F_n[E, s]))  = d(log(Y[s])) - d(log(PROG[E, s])) - GR_PROG_base[E, s] + d(SUBST_F[E, s])                                                 if F_n[E, s] <> 0

##! Energy consumption $ce$ of sector $s$
@over d(log(CI[ce, s]))    = d(log(F[E, s])) + d(SUBST_CI[ce,s]) - GR_CI_base[ce, s] if CI[ce, s]  <> 0

GR_CI_base[ce, s] = GR_CI_base[ce]  where s in %list_sec \ soil sbfu sgas sbga senu seoi sega seco sewi seso sehy sech seot

##! Substitution effect on the energy intermediate consumption $ce$ in the sector $s$
@over d(SUBST_CI_n[ce, s]) = sum(- ES_NRJ[ce, cee, s] * phi[E, cee, s]{-1} * d(log(PCI[ce, s] * exp(PS_CI[ce, s])) - log(PCI[cee, s]*exp(PS_CI[cee, s]))) on cee)      if CI[ce, s]  <> 0
# Inclusion of a price signal PS_CI[ce, s]

PS_CI[ce, s] = PS_CI[ce]

# ##! Notional substitution between the transport $ct$ and the other transports $mt$ in the sector $s$
# @over d(SUBST_CI_n[ct, s]) = sum(- ES_TRSP[ct, ctt, s] * phi_TRSP[ctt, s]{-1} * d(log(PCI[ct, s]) - log(PCI[ctt, s])) on ctt)   if CI[ct, s]  <> 0
# Inclusion of a price signal if we want to fit transport targets

### Fitting energy consumption for households
# !!!! TO DO: Stock of building per class and ENERperM2[ecl, ceb]
# NCH_BUIL[ce] --> BUIL[ecl] : 
# Add trend in:
##! Consumption of energy $ceb$ per square meter in class $ecl$ buildings
#d(log(ENERperM2[ecl, ceb])) = - eta_ENERperM2[ecl, ceb] * d(log(PCH[ceb])-log(PCH)) * (d(log(PCH[ceb])-log(PCH)) >0) _
#                                + d(SUBST_NRJperM2[ecl, ceb]) if ENERperM2[ecl, ceb] <> 0
# - GR_PROG_HOUS_base

## TO DO : ADD TREND IN
##! Kilometer-travelers for air transport
#d(log(km_traveler[cair])) = (@year > %baseyear) * (theta_kmtravcair_DISPINC * d(log(DISPINC_AT_VAL/PCH)) - theta_kmtravcair_Pkmtrav * d(log(P_km_traveler[cair]/PCH))) + (@year <= %baseyear) * (0)
# Expressed in million.

##! Kilometer-travelers for long distance transport (by automobile and train)
# d(log(km_traveler_LD)) = (@year > %baseyear) * (theta_kmtravLD_DISPINC * d(log(DISPINC_AT_VAL/PCH)) - theta_kmtravLD_Pkmtrav * d(log(P_km_traveler_LD/PCH))) + (@year <= %baseyear) * (0)
# Expressed in million.

##! Kilometer-travelers for short distance transport (by automobile and bus)
#d(log(km_traveler_SD)) = (@year > %baseyear) * (theta_kmtravSD_DISPINC * d(log(DISPINC_AT_VAL/PCH)) - theta_kmtravSD_Pkmtrav * d(log(P_km_traveler_SD/PCH))) + (@year <= %baseyear) * (0)
# Expressed in million.

#### Energy balance  



#### Additional outputs


##! Carbon tax in volume on households' consumption
T2VOL_CH[ghg,c] =  T2VAL_CH[ghg,c]/PCH 					if EMS_CH[ghg,c] <> 0
T2VOL_CH[ghg] = sum(T2VOL_CH[ghg,c] on c)

##! Carbon tax in volume on intermediary consumption 
T2VOL_CI[ghg,c] = T2VAL_CI[ghg,c]/PCH
T2VOL_CI[ghg] = sum(T2VOL_CI[ghg,c] on c)

##! Carbon tax rate on the greenhouse gas $ghg$ associated to the intermediary consumption of commodity $c$ by the sector $s$
R2_CI_CO2[c,s] = RCO2TAX_VOL*PCH

##! Carbon tax rate on the greenhouse gas $ghg$ associated to the material consumption of the sector $s$
R2_MAT_CO2[s]= RCO2TAX_VOL*PCH

##! Carbon tax rate on the greenhouse gas $ghg$ associated to the final production of the sector $s$
R2_Y_CO2[s] = RCO2TAX_VOL*PCH

##! Carbon tax rate on the greenhouse gas $ghg$ associated to the household final consumption of the sector $s$
R2_CH_CO2[c] = RCO2TAX_VOL*PCH

##! Investment in agregate sector 
IA_IND  = sum(IA[sind]  on sind)
IA_TRSP = sum(IA[strsp] on strsp)
IA_SER  = sum(IA[sser]  on sser)
IA_TRSF = sum(IA[strsf] on strsf)
IA_ELE  = sum(IA[sele]  on sele)

##! Labor in agregate sector 
F_L_IND  = sum(F[L, sind] on sind)
F_L_TRSP = sum(F[L, strsp] on strsp)
F_L_SER  = sum(F[L, sser] on sser)
F_L_TRSF = sum(F[L, strsf] on strsf)
F_L_ELE  = sum(F[L, sele] on sele)

##! added value in agregate sector 
VA_IND  = sum(VA[sind] on sind)
VA_TRSP = sum(VA[strsp] on strsp)
VA_SER  = sum(VA[sser] on sser)
VA_TRSF = sum(VA[strsf] on strsf)
VA_ELE  = sum(VA[sele] on sele)

##! added value in agregate sector 
Y_IND  = sum(Y[sind] on sind)
Y_TRSP = sum(Y[strsp] on strsp)
Y_SER  = sum(Y[sser] on sser)
Y_TRSF = sum(Y[strsf] on strsf)
Y_ELE  = sum(Y[sele] on sele)

##! Emissions of the greenhouse gas $ghg$ related to the intermediary consumption of commodity $c$ by agregate sector
EMS_CI[ghg, c, IND]  = sum(EMS_CI[ghg, c, sind]   if EMS_CI[ghg, c, sind] <> 0 on sind)    if EMS_CI[ghg, c, IND] <> 0
EMS_CI[ghg, c, TRSP] = sum(EMS_CI[ghg, c, strsp] if EMS_CI[ghg, c, strsp] <> 0 on strsp)  if EMS_CI[ghg, c, TRSP] <> 0
EMS_CI[ghg, c, SER]  = sum(EMS_CI[ghg, c, sser]   if EMS_CI[ghg, c, sser] <> 0 on sser)    if EMS_CI[ghg, c, SER] <> 0
EMS_CI[ghg, c, TRSF] = sum(EMS_CI[ghg, c, strsf] if EMS_CI[ghg, c, strsf] <> 0 on strsf)  if EMS_CI[ghg, c, TRSF] <> 0
EMS_CI[ghg, c, ELE]  = sum(EMS_CI[ghg, c, sele]  if EMS_CI[ghg, c, ele] <> 0 on sele)    if EMS_CI[ghg, c, ELE] <> 0

##! Emissions of the greenhouse gas $ghg$ related to the intermediary consumption by sector $s$
EMS_CI[ghg, sagg]  = sum(EMS_CI[ghg, c, sagg] if EMS_CI[ghg, c, sagg] <> 0 on c)  if EMS_CI[ghg, sagg] <> 0

verif_EMS_CI[ghg]  = sum(EMS_CI[ghg, sagg] on sagg) - EMS_CI[ghg] 

# !!! TO DO: UPDATE depending on the targets of the SNBC!
# introduce all the relevent commodities
##! End use for energy consumption of households related to housing, expressed in toe
#CH_toe_hous = CH_toe[cfuh] + CH_toe[cgas] + CH_HOUS_toe[cele]
#CH_HOUS_toe[cele] =  CH_toe[cele] * CH_HOUS[cele] / (CH_HOUS[cele] + CH_TRSP[cele])

##! End use for energy consumption of households related to transport, expressed in toe
#CH_toe_trsp = CH_toe[cfut] + CH_TRSP_toe[cele]
#CH_TRSP_toe[cele] = CH_toe[cele] * CH_TRSP[cele] / (CH_HOUS[cele] + CH_TRSP[cele])

##! End use for energy $ce$ of agregate sector, expressed in toe 
CI_toe[ce, IND]  = sum(CI_toe[ce, sind]   if CI_toe[ce, sind] <> 0 on sind)    if CI_toe[ce, IND]  <> 0
CI_toe[ce, TRSP] = sum(CI_toe[ce, strsp] if CI_toe[ce, strsp] <> 0 on strsp)   if CI_toe[ce, TRSP] <> 0
CI_toe[ce, SER]  = sum(CI_toe[ce, sser]   if CI_toe[ce, sser] <> 0 on sser)     if CI_toe[ce, SER] <> 0
CI_toe[ce, TRSF] = sum(CI_toe[ce, strsf] if CI_toe[ce, strsf] <> 0 on strsf)  if CI_toe[ce, TRSF]  <> 0
CI_toe[ce, ELE]  = sum(CI_toe[ce, sele]   if CI_toe[ce, sele] <> 0 on sele)     if CI_toe[ce, ELE]  <> 0

##! Final consumption (energy balance definition) for energy $ce$, expressed in toe
CF_toe[ce] = CI_toe[ce, IND] + CI_toe[ce, TRSP] + CI_toe[ce, SER] + CH_toe[ce]

##! Final consumption (energy balance definition) of economic sectors for energy $ce$, expressed in toe
CF_CI_toe[ce] = CI_toe[ce, IND] + CI_toe[ce, TRSP] + CI_toe[ce, SER]


##! End use for agregate energy of agregate sector, expressed in toe 
CI_toe[sagg] = sum(CI_toe[ce, sagg] if CI_toe[ce, sagg] <> 0 on ce) if CI_toe[sagg] <> 0

Verif_CI_toe = sum(CI_toe[sagg] on sagg) - CI_toe

##! Net production of energy $ce$ by agregate sector, expressed in toe 
Y_toe[ce, IND]  = sum(Y_toe[ce, sind]     if Y_toe[ce, sind] <> 0 on sind)    if Y_toe[ce, IND]  <> 0
Y_toe[ce, TRSP] = sum(Y_toe[ce, strsp]   if Y_toe[ce, strsp] <> 0 on strsp)   if Y_toe[ce, TRSP] <> 0
Y_toe[ce, SER]  = sum(Y_toe[ce, sser]     if Y_toe[ce, sser] <> 0 on sser)     if Y_toe[ce, SER] <> 0
Y_toe[ce, TRSF] = sum(Y_toe[ce, strsf]   if Y_toe[ce, strsf] <> 0 on strsf)  if Y_toe[ce, TRSF]  <> 0
Y_toe[ce, ELE]  = sum(Y_toe[ce, sele]     if Y_toe[ce, sele] <> 0 on sele)    if Y_toe[ce, ELE]  <> 0 

##! Net production of agregate energy by agregate sector, expressed in toe 
Y_toe[sagg] = sum(Y_toe[ce, sagg] if Y_toe[ce, sagg] <> 0 on ce) if Y_toe[sagg] <> 0

Verif_Y_toe = sum(Y_toe[sagg] on sagg) - Y_toe

## To be deleted : when the addfactor error is corrected
# @over verif_PhiY[ce, s] = 0



