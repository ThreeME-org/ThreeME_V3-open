include ..\model\lists

### From producer block

phi_MGPD[cc, c] := PMGPD[cc, c] * MGPD[cc, c] / (sum(PMGPD[ccc, c] * MGPD[ccc, c] on ccc))
phi_MGPM[cc, c] := PMGPM[cc, c] * MGPM[cc, c] / (sum(PMGPM[ccc, c] * MGPM[ccc, c] on ccc))


phi[f, s] := C[f, s] * F_n[f, s] / (sum(C[ff, s] * F_n[ff, s] on ff))

phi[E, ce, s] := PCI[ce, s]*CI[ce, s] / (sum(PCI[cee, s]*CI[cee, s] on cee))

phi_TRSP[ct, s] := PCI[ct, s]*CI[ct, s] / (sum(PCI[ctt, s]*CI[ctt, s] on ctt))

F[K] := sum(F[K, s] on s)
F[L] := sum(F[L, s] on s)
F[E] := sum(F[E, s] on s)
F[MAT] := sum(F[MAT, s] on s)

### From GOV:
NTAXPD_VAL[c] := RNTAXPD[c]*PYQ[c]*YQ[c]

NTAXPM_VAL[c] := RNTAXPM[c]*PM[c]*M[c]

NTAXI_VAL[s] := RNTAXI[s]*PY[s]*Y[s]

RSSC := sum(RSSC[s] on s)

RRSSC := PRSSC * RSSC / (W * F[L]) 

INC_G_VAL := PNTAXP * NTAXP + NTAXI_VAL + INC_SOC_TAX_VAL + PRSSC * RSSC + PROP_INC_G_VAL

SPEND_G_VAL := PG  * G  + SOC_BENF_VAL + DEBT_G_VAL{-1}*(Phi_RD_G{-1} + r_DEBT_G{-1}) 

SAV_G_VAL := INC_G_VAL - SPEND_G_VAL

Bal_G_Prim_VAL := SAV_G_VAL + DEBT_G_VAL{-1}*(Phi_RD_G{-1} + r_DEBT_G{-1})
Bal_G_Prim_VALbis := INC_G_VAL - (PG  * G  + SOC_BENF_VAL)

Bal_G_Tot_VAL := Bal_G_Prim_VAL - DEBT_G_VAL{-1}*r_DEBT_G{-1} 

RSAV_G_VAL := SAV_G_VAL / (PGDP * GDP)

RBal_G_Prim_VAL := Bal_G_Prim_VAL / (PGDP * GDP)

RBal_G_Tot_VAL := Bal_G_Tot_VAL / (PGDP * GDP)

RDEBT_G_VAL := DEBT_G_VAL / (PGDP * GDP)


### From Demographic block
Un := LF - Empl
UnR := Un / LF


### From consumer
DISPINC_BT_VAL := PWAGES * WAGES + PROP_INC_H_VAL + SOC_BENF_VAL + TRSF_HH_VAL

DISPINC_AT_VAL := DISPINC_BT_VAL - INC_SOC_TAX_VAL

NCH := sum(NCH[c] on c)

PCH_CES := (sum(@elem(phi_MCH[c], %baseyear) * PCH[c] ^ (1 - ES_LESCES) on c)) ^ (1 / (1 - ES_LESCES))

Phi_CH[c] := CH[c]/CH

SAV_H_VAL := DISPINC_AT_VAL - PCH * CH

# Households savings rate
RSAV_H_VAL := SAV_H_VAL / DISPINC_AT_VAL


# From International trade
Bal_Trade_VAL[c] := PX[c] * X[c] - PM[c] * M[c]

Bal_Trade_VAL := sum(Bal_Trade_VAL[c] on c)

RBal_Trade_VAL := Bal_Trade_VAL / (PGDP * GDP)


# From emissions

EMS_CI[ghg,c] := sum(EMS_CI[ghg,c,s] on s)

EMS_CI[ghg,s] := sum(EMS_CI[ghg,c,s] on c)

EMS_CI[ghg] := sum(EMS_CI[ghg,s] on s)

EMS_CIbis[ghg] := sum(EMS_CI[ghg,c] on c)

EMS_MAT[ghg] := sum(EMS_MAT[ghg,s] on s)

EMS_Y[ghg] := sum(EMS_Y[ghg,s] on s)

EMS_CH[ghg] := sum(EMS_CH[ghg,c] on c)

EMS[ghg] := EMS_CI[ghg] + EMS_MAT[ghg] + EMS_Y[ghg] + EMS_CH[ghg]

EMS_CI := sum(EMS_CI[ghg] on ghg)

EMS_MAT := sum(EMS_MAT[ghg] on ghg)

EMS_Y := sum(EMS_Y[ghg] on ghg)

EMS_CH := sum(EMS_CH[ghg] on ghg)

EMS := EMS_CI + EMS_MAT + EMS_Y + EMS_CH

EMSbis := sum(EMS[ghg] on ghg)
